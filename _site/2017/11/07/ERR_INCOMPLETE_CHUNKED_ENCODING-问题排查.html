 <!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="keywords" content="chrome,nginx">
  <meta name="description" content="chrom浏览器吐出部分内容，控制台报错:ERR_INCOMPLETE_CHUNKED_ENCODING">
  <meta name="author" content="张要辉">



    <title>ERR_INCOMPLETE_CHUNKED_ENCODING 问题排查</title>
  <link rel="shortcut icon" href="/assets/img/icon2.ico">
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css">
	
	<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>

<nav class="navbar navbar-default">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">

      <a class="navbar-brand" href="#"><img alt="Brand" width="30" height="30" src="/assets/img/icon1.png"></a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="/">Home <span class="sr-only">(current)</span></a></li>
        <li><a href="https://github.com/zhangyaohui1986" target="_blank">Github</a></li>
        <li><a href="#">About</a></li>
      </ul>
      
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container -->
</nav>



<style type="text/css">
    .edwin-top-desc .jumbotron{
        color: white;
        background-image: -webkit-gradient(linear,left top,left bottom,from(#563d7c),to(#6f5499));
        background-image: -webkit-linear-gradient(top,#563d7c 0,#6f5499 100%);
        background-image: -o-linear-gradient(top,#563d7c 0,#6f5499 100%);
        background-image: linear-gradient(to bottom,#563d7c 0,#6f5499 100%);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#563d7c', endColorstr='#6F5499', GradientType=0);
        background-repeat: repeat-x;
        padding: 30px 0;
    }
    .edwin-top-desc .post-title{
        margin-right: 20%;
    }
    .edwin-top-desc .post-desc{
        font-size: 22px;
        font-weight: 300;
        margin-right: 20%;
        color: #cdbfe3;
        text-shadow: 0 1px 0 rgba(0,0,0,.1);
    }
    .edwin-top-desc .post-date{
        color: #e3ddec;
    }
    .edwin-post-content{
        min-height: 45%;
        font-size: 125%;
        line-height: 1.6;
    }
</style>

<header class="edwin-top-desc">
    <div class="jumbotron">
        <div class="container">
            <h2 class="post-title">ERR_INCOMPLETE_CHUNKED_ENCODING 问题排查</h2>
            <p class="post-desc">chrom浏览器吐出部分内容，控制台报错:ERR_INCOMPLETE_CHUNKED_ENCODING</p>
            
            <span class="post-date">
                <i class="fa fa-calendar" aria-hidden="true"></i>
                <!-- <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span> -->
                <span>2017-11-07</span>
            </span>
            
        </div>
    </div>
</header>

<!-- content -->
<div class="container">

    <div class="row">
        <div class="col-md-10">
            <div class="edwin-post-content">
                <p>开发调试一个接口时，chrom浏览器吐出部分内容，控制台报错:
<code class="highlighter-rouge">Failed to load resource: net::ERR_INCOMPLETE_CHUNKED_ENCODING</code>,于是查看nginx 错误日志：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>[crit] 7476#0: *954 open() "/usr/local/var/run/nginx/fastcgi_temp/8/02/0000000028" failed (13: Permission denied) while reading upstream, client: 127.0.0.1, server: 127.0.0.1, request: "GET /v1/report/error-list?dept_id=68 HTTP/1.1", upstream: "fastcgi://unix:/tmp/php-cgi.sock:", host: "127.0.0.1:8202"
</code></pre>
</div>
<p>看起来是权限问题，于是查看权限：</p>
<div class="highlighter-rouge"><pre class="highlight"><code> ll /usr/local/var/run/nginx/proxy_temp
drwx------  12 _www  admin  408 11  7 14:24 fastcgi_temp
</code></pre>
</div>
<p>果断修改之：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>sudo chown -R www:www /usr/local/var/run/nginx/
</code></pre>
</div>
<p>然后再测试下接口，chrome不再报错，内容全部返回，大功告成！</p>

<h1 id="nginx-fastcgi_tmp-的作用">nginx fastcgi_tmp 的作用</h1>
<p>对于来自 FastCGI Server 的 Response，Nginx 将其缓冲到内存中，然后依次发送到客户端浏览器。缓冲区的大小由 fastcgi_buffers 和 fastcgi_buffer_size 两个值控制。
比如如下配置：</p>
<div class="highlighter-rouge"><pre class="highlight"><code>fastcgi_buffers      8 4K;
fastcgi_buffer_size  4K;
</code></pre>
</div>
<p>意思就是nginx将创建8*4k +4k =36k的缓冲区。如果response 内容小于36K,直接内存处理，那么大于36k，将触发部分内容写到fastcgi_tmp目录的临时文件。所以，正是由于fastcgi_tmp 目录权限问题导致部分内容显示。</p>

<p>显然，fastcgi_buffers 设置太小，nginx将频繁读写磁盘，影响系统性能,所以fastcgi_buffers 参数调整很重要啊^_^</p>


            </div>
        </div>

        <div class="col-md-2">
            <!-- this is COL-MD-22222, for some contents -->
        </div>
    </div>

</div>

 <style type="text/css">
	.footer {
	   padding: 15px 0;
       margin: 40px 0 0 0;
       text-align: center;
       border-top: 1px solid #eee
	}
	.footer .contact-list {
		margin-bottom: 0;
        padding-left: 0;
	}
	.footer .contact-list li {
		display: inline-block;
        line-height: 1;
	}

	.footer .contact-list li a {
		color: #555;
	}

	.footer .contact-list>li+li:before {
        padding: 0 10px;
        color: #ccc;
        content: "|";
    }
    .footer .contact-list li .fa {
    	font-size: 16px;
        margin-right: 3px;
    }
</style>
<footer class="footer">
      <div class="container">
      	<ul class="contact-list">
			<li>
                <a href="mailto:511191969@qq.com" title="email">
                    <i class="fa fa-envelope-o"></i> Email To Me
                </a>
            </li>
            <li>
                <a href="http://weibo.com/2081267207/profile?topnav=1&wvr=6&is_all=1" title="新浪微博" target="_blank">
                    <i class="fa fa-weibo"></i> 新浪微博：@张要辉
                </a>
            </li>
            <li>
                <a href="https://github.com/zhangyaohui1986" title="GitHub" target="_blank">
                    <i class="fa fa-github-square"></i> GitHub
                </a>
            </li>
            <li>
                <i class="fa fa-heart-o" ></i>Powered by Github
            </li>      		
      	</ul>
      </div>
</footer>

</body>
</html>